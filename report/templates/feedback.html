<!DOCTYPE html>
{% extends "base.html" %}

{% block title %}Writing Field | Practice Portal{% endblock %}

{% block content %}
    <!-- ページタイトル -->
    <h1 class="mb-4 text-secondary text-center fw-bold fs-2" style="letter-spacing: 1px; border-bottom: 2px solid #6c757d; padding-bottom: 0.5rem;">
        Feedback
    </h1>
    <h2 class="text-secondary mb-3 fw-bold">Introduction:</h2> 
    <ul class="text-secondary mb-4"> 
        <li>このページではあなたの回答に対するGeminiからのフィードバックを提供します</li> 
        <li>AIなので適当なことを言っている可能性に注意してください</li> 
        <li>スコアはあくまで"参考"です</li> 
    </ul>

    <!-- Feedback -->
    <h2 class="mt-3 mb-3 text-secondary border-bottom pt-2 fw-bold">Feedback from Gemini</h2>
    {% if feedback %}
        {% if feedback.error %}
            <div class="alert alert-danger mt-3">
                {{ feedback.error }}<br>
                <pre>{{ feedback.raw }}</pre>
            </div>
        {% else %}
            <div class="card mt-4">
                <div class="card-body">
                    <h4 class="card-title">Score: {{ feedback.score }}/10</h4>
                    <h5 class="mt-3">Grammar & Spelling Errors:</h5>
                    <ul>
                    {% for err in feedback.grammar_and_spell_errors %}
                        <li>{{ err }}</li>
                    {% endfor %}
                    </ul>
                    <h5 class="mt-3">Corrected Text:</h5>
                    <p class="text-success">{{ feedback.corrected_text }}</p>
                    <h5 class="mt-3">Improved Text:</h5>
                    <p class="text-primary">{{ feedback.improved_text }}</p>
                    <h5 class="mt-3">Explanation:</h5>
                    <p>{{ feedback.explanation }}</p>
                    <h5 class="mt-3">Feedback:</h5>
                    <p>{{ feedback.feedback }}</p>
                </div>
            </div>
        {% endif %}
    {% endif %}

    <form method="POST" action="{{ url_for('report.report') }}">
        <input type="hidden" name="user_text" value="{{ user_text }}">
        <input type="hidden" name="test_type" value="{{ test_type }}">
        <input type="hidden" name="skill_type" value="{{ skill_type }}">
        <input type="hidden" name="task_type" value="{{ task_type }}">
        <input type="hidden" name="feedback" value='{{ feedback|tojson }}'>
        <button type="submit" class="btn btn-outline-secondary btn-sm mt-2">
            <i class="bi bi-file-earmark-pdf"></i> Download PDF
        </button>
    </form>
</div>
{% endblock %}
